# ./pipeline-dir/my-pipe.yaml
context_parser: pypyr.parser.keyvaluepairs
steps:
  - name: pypyr.steps.py
    comment: define a function to incremenet context progress in run dectorators.
    in:
      pycode: |
        # add one for this task
        context['progress'] += 1

        def increase_progress():
          context['progress'] += 1
          return context['progress']

        context['increase_progress'] = increase_progress
  
  - name: pypyr.steps.echo
    run: !py increase_progress()
    in:
      echoMe: piper {arbkey} that {anotherkey} again
  - name: pypyr.steps.contextsetf
    run: !py increase_progress()
    in:
      contextSetf:
        myoutput: I was set in the pipeline!
        some_nesting:
          down_level:
            arb_number: 123
            arb_bool: False

on_success:
  - name: pypyr.steps.contextsetf
    in:
      contextSetf:
        finished: True
